# -*- coding: utf-8 -*-
"""Loan_Prediction(2) _Deployment.csv

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1JUN288tgLE3f0R7EWk199b5GG8rR4ZPn
"""

from google.colab import files
uploaded = files.upload()
print(uploaded)













import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

df = pd.read_csv('Loan prediction (2).csv')
df.shape



df.isnull().sum()

df['LoanAmount'] = df['LoanAmount'].fillna(df['LoanAmount'].mean())

df['Credit_History'] = df['Credit_History'].fillna(df['Credit_History'].mode()[0])

df.isnull().sum()

df['Gender'] = df['Gender'].fillna(df['Gender'].mode()[0])

df['Married'] = df['Married'].fillna(df['Married'].mode()[0])

df['Dependents'] = df['Dependents'].fillna(df['Dependents'].mode()[0])

df['Self_Employed'] = df['Self_Employed'].fillna(df['Self_Employed'].mode()[0])

df['Loan_Amount_Term'] = df['Loan_Amount_Term'].fillna(df['Loan_Amount_Term'].mode()[0])

df.isnull().sum()

df['Gender'] = df['Gender'].fillna(df['Gender'].mode()[0])

df['Married'] = df['Married'].fillna(df['Married'].mode()[0])

df['Dependents'] = df['Dependents'].fillna(df['Dependents'].mode()[0])

df['Self_Employed'] = df['Self_Employed'].fillna(df['Self_Employed'].mode()[0])

df['Loan_Amount_Term'] = df['Loan_Amount_Term'].fillna(df['Loan_Amount_Term'].mode()[0])

df.isnull().sum()

df['Gender'] = df['Gender'].map({'Male':1, 'Female':0})

df['Married'] = df['Married'].map({'Yes':1, 'No':0})

df['Education'] = df['Education'].map({'Graduate':1, 'Not Graduate':0})

df['Self_Employed'] = df['Self_Employed'].map({'Yes':1, 'No':0})

original_loan_status = pd.read_csv('Loan prediction (2).csv')['Loan_Status']
df['Loan_Status'] = original_loan_status.replace({'Y':1, 'N':0}).astype(int)

from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

print('First 5 rows of X (features):')
print(X.head())
print('\nFirst 5 rows of y (target variable):')
print(y.head())

X = df.drop('Loan_Status', axis=1)

y = df['Loan_Status']

print(X.head())
print(y.head())

print('First 5 rows of X (features):')
print(X.head())
print('\nFirst 5 rows of y (target variable):')
print(y.head())

X = df.drop('Loan_Status', axis=1)

y = df['Loan_Status']

X = df.drop('Loan_Status', axis=1)

y = df['Loan_Status']

df = df.drop(['Loan_ID'], axis=1, errors='ignore')

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred = model.predict(X_test)

accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print(f'Model Accuracy: {accuracy:.4f}')
print(f'Model Precision: {precision:.4f}')
print(f'Model Recall: {recall:.4f}')
print(f'Model F1-Score: {f1:.4f}')

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred = model.predict(X_test)

accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print(f'Model Accuracy: {accuracy:.4f}')
print(f'Model Precision: {precision:.4f}')
print(f'Model Recall: {recall:.4f}')
print(f'Model F1-Score: {f1:.4f}')

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred = model.predict(X_test)

accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print(f'Model Accuracy: {accuracy:.4f}')
print(f'Model Precision: {precision:.4f}')
print(f'Model Recall: {recall:.4f}')
print(f'Model F1-Score: {f1:.4f}')

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred = model.predict(X_test)

accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print(f'Model Accuracy: {accuracy:.4f}')
print(f'Model Precision: {precision:.4f}')
print(f'Model Recall: {recall:.4f}')
print(f'Model F1-Score: {f1:.4f}')

X = pd.get_dummies(X, columns=['Property_Area'], drop_first=True, dtype=int)

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

from sklearn.linear_model import LogisticRegression

model = LogisticRegression(max_iter=1000)
model.fit(X_train, y_train)

df['Dependents'] = df['Dependents'].replace('3+', '3').astype(int)

from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

from sklearn.linear_model import LogisticRegression

model_scaled = LogisticRegression(max_iter=1000)
model_scaled.fit(X_train_scaled, y_train)

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred_scaled = model_scaled.predict(X_test_scaled)

accuracy_scaled = accuracy_score(y_test, y_pred_scaled)
precision_scaled = precision_score(y_test, y_pred_scaled)
recall_scaled = recall_score(y_test, y_pred_scaled)
f1_scaled = f1_score(y_test, y_pred_scaled)

print(f'Scaled Model Accuracy: {accuracy_scaled:.4f}')
print(f'Scaled Model Precision: {precision_scaled:.4f}')
print(f'Scaled Model Recall: {recall_scaled:.4f}')
print(f'Scaled Model F1-Score: {f1_scaled:.4f}')

from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

from sklearn.linear_model import LogisticRegression

model_scaled = LogisticRegression(max_iter=1000)
model_scaled.fit(X_train_scaled, y_train)

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred_scaled = model_scaled.predict(X_test_scaled)

accuracy_scaled = accuracy_score(y_test, y_pred_scaled)
precision_scaled = precision_score(y_test, y_pred_scaled)
recall_scaled = recall_score(y_test, y_pred_scaled)
f1_scaled = f1_score(y_test, y_pred_scaled)

print(f'Scaled Model Accuracy: {accuracy_scaled:.4f}')
print(f'Scaled Model Precision: {precision_scaled:.4f}')
print(f'Scaled Model Recall: {recall_scaled:.4f}')
print(f'Scaled Model F1-Score: {f1_scaled:.4f}')

from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

from sklearn.linear_model import LogisticRegression

model_scaled = LogisticRegression(max_iter=1000)
model_scaled.fit(X_train_scaled, y_train)

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred_scaled = model_scaled.predict(X_test_scaled)

accuracy_scaled = accuracy_score(y_test, y_pred_scaled)
precision_scaled = precision_score(y_test, y_pred_scaled)
recall_scaled = recall_score(y_test, y_pred_scaled)
f1_scaled = f1_score(y_test, y_pred_scaled)

print(f'Scaled Model Accuracy: {accuracy_scaled:.4f}')
print(f'Scaled Model Precision: {precision_scaled:.4f}')
print(f'Scaled Model Recall: {recall_scaled:.4f}')
print(f'Scaled Model F1-Score: {f1_scaled:.4f}')

from sklearn.preprocessing import StandardScaler

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

from sklearn.linear_model import LogisticRegression

model_scaled = LogisticRegression(max_iter=1000)
model_scaled.fit(X_train_scaled, y_train)

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred_scaled = model_scaled.predict(X_test_scaled)

accuracy_scaled = accuracy_score(y_test, y_pred_scaled)
precision_scaled = precision_score(y_test, y_pred_scaled)
recall_scaled = recall_score(y_test, y_pred_scaled)
f1_scaled = f1_score(y_test, y_pred_scaled)

print(f'Scaled Model Accuracy: {accuracy_scaled:.4f}')
print(f'Scaled Model Precision: {precision_scaled:.4f}')
print(f'Scaled Model Recall: {recall_scaled:.4f}')
print(f'Scaled Model F1-Score: {f1_scaled:.4f}')

X = df.drop('Loan_Status', axis=1)
y = df['Loan_Status']
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred = model.predict(X_test)

accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print(f'Model Accuracy: {accuracy:.4f}')
print(f'Model Precision: {precision:.4f}')
print(f'Model Recall: {recall:.4f}')
print(f'Model F1-Score: {f1:.4f}')

# Ensure 'Dependents' is numerical (already done but good to have context)
df['Dependents'] = df['Dependents'].replace('3+', '3').astype(int)

# Define X and y from the latest df
X = df.drop('Loan_Status', axis=1)
y = df['Loan_Status']

# Apply one-hot encoding to 'Property_Area' in X
X = pd.get_dummies(X, columns=['Property_Area'], drop_first=True, dtype=int)

# Split the data into training and testing sets
from sklearn.model_selection import train_test_split
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# Fit the Logistic Regression model again
from sklearn.linear_model import LogisticRegression
model = LogisticRegression(max_iter=1000)
model.fit(X_train, y_train)

from sklearn.metrics import accuracy_score, precision_score, recall_score, f1_score

y_pred = model.predict(X_test)

accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print(f'Model Accuracy: {accuracy:.4f}')
print(f'Model Precision: {precision:.4f}')
print(f'Model Recall: {recall:.4f}')
print(f'Model F1-Score: {f1:.4f}')

# Ensure 'Dependents' is numerical (re-executing for certainty)
df['Dependents'] = df['Dependents'].replace('3+', '3').astype(int)

# Define X and y from the latest df
X = df.drop('Loan_Status', axis=1)
y = df['Loan_Status']

# Apply one-hot encoding to 'Property_Area' in X
X = pd.get_dummies(X, columns=['Property_Area'], drop_first=True, dtype=int)

# Split the data into training and testing sets
from sklearn.model_selection import train_test_split
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# Fit the Logistic Regression model again
from sklearn.linear_model import LogisticRegression
model = LogisticRegression(max_iter=1000)
model.fit(X_train, y_train)

new_data_dict = {
    'Gender': 1, 'Married': 1, 'Dependents': 1, 'Education': 1, 'Self_Employed': 0,
    'ApplicantIncome': 5000, 'CoapplicantIncome': 0, 'LoanAmount': 150,
    'Loan_Amount_Term': 360, 'Credit_History': 1,
    'Property_Area_Semiurban': 0, 'Property_Area_Urban': 1 # Assuming Urban for this example
}

# Create a DataFrame from the new data dictionary
import pandas as pd
new_df = pd.DataFrame([new_data_dict])

# Ensure the columns are in the same order as X_train
new_df = new_df[X_train.columns]

# Make the prediction
prediction = model.predict(new_df)

print(f'Prediction for new data: {prediction[0]}')

# Optionally, you can interpret the prediction
if prediction[0] == 1:
    print("Loan Status: Approved (1)")
else:
    print("Loan Status: Not Approved (0)")

from sklearn.metrics import accuracy_score

accuracy = accuracy_score(y_test, y_pred)
print(accuracy)

plt.figure(figsize=(6,4))
sns.countplot(x='Education', hue='Loan_Status', data=df)
plt.title("Education vs Loan Approval")
plt.xlabel("Education (0 = Not Graduate, 1 = Graduate)")
plt.ylabel("Count")
plt.show()

plt.figure(figsize=(6,4))
sns.countplot(x='Credit_History', hue='Loan_Status', data=df)
plt.title("Credit History Impact on Loan Approval")
plt.xlabel("Credit History")
plt.ylabel("Count")
plt.legend(title="Loan Status")
plt.show()

plt.figure(figsize=(6,4))
sns.countplot(x='Loan_Status', data=df)
plt.title("Loan Approval Distribution")
plt.xlabel("Loan Status (0 = Rejected, 1 = Approved)")
plt.ylabel("Number of Applicants")
plt.show()

plt.figure(figsize=(6,4))
sns.boxplot(x='Loan_Status', y='LoanAmount', data=df)
plt.title("Loan Amount vs Loan Status")
plt.xlabel("Loan Status")
plt.ylabel("Loan Amount")
plt.show()

plt.figure(figsize=(6,4))
sns.histplot(df['ApplicantIncome'], bins=30, kde=True)
plt.title("Applicant Income Distribution")
plt.xlabel("Applicant Income")
plt.ylabel("Frequency")
plt.show()

from sklearn.metrics import confusion_matrix
import matplotlib.pyplot as plt
import seaborn as sns

cm = confusion_matrix(y_test, y_pred)

plt.figure(figsize=(5,4))
sns.heatmap(cm, annot=True, fmt='d', cmap='Blues')
plt.title("Confusion Matrix")
plt.xlabel("Predicted")
plt.ylabel("Actual")
plt.show()

import pickle

# model save
with open("Loan_prediction_Model.pkl", "wb") as f:
    pickle.dump(model, f)



















